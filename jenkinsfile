pipeline {
    agent any

    stages {
        stage ('Compile Test'){
            steps {
                sh "mvn compile test"
            }
        }
        
        stage ('Package Sonar') {
            steps {
                sh "mvn clean package -DskipTests=true sonar:sonar -Dsonar.projectKey=ScannerMavenJenkins \
                                                  -Dsonar.host.url=http://172.28.224.1:8082 \
                                                  -Dsonar.login=sqp_98788e87facf9eeb7295ce9a2ebc2c54bf292101"
            }
        }
        
        stage ('Reporting') {
            steps {
                sh "mvn clean clover:setup verify clover:aggregate clover:clover"
            }
        }
     }

    post {
        failure {
                slackSend message:  "FAILED ${env.JOB_NAME} ${env.BUILD_NUMBER}" 
        }
    }
}
